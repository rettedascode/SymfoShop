{% extends 'base.html.twig' %}

{% block title %}Checkout - SymfoShop{% endblock %}

{% block body %}
    <h1 class="mb-4">
        <i class="bi bi-credit-card"></i> Checkout
    </h1>

    <form method="post" action="{{ path('app_checkout_process') }}">
        <div class="row">
            <!-- Order Summary -->
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="bi bi-cart"></i> Order Summary
                        </h5>
                    </div>
                    <div class="card-body">
                        {% for item in cart_items %}
                            <div class="d-flex justify-content-between mb-2">
                                <span>{{ item.product.name }} (x{{ item.quantity }})</span>
                                <span>${{ item.subtotal|number_format(2) }}</span>
                            </div>
                        {% endfor %}
                        <hr>
                        <div class="d-flex justify-content-between">
                            <strong>Total:</strong>
                            <strong class="text-primary">${{ total|number_format(2) }}</strong>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Checkout Forms -->
            <div class="col-md-8">
                <!-- Payment Method -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="bi bi-credit-card"></i> Payment Method
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="payment_method" class="form-label">Payment Method</label>
                            <select class="form-select" id="payment_method" name="payment_method" required>
                                <option value="">Select payment method</option>
                                <option value="credit_card">Credit Card</option>
                                <option value="paypal">PayPal</option>
                                <option value="bank_transfer">Bank Transfer</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label for="shipping_method" class="form-label">Shipping Method</label>
                            <select class="form-select" id="shipping_method" name="shipping_method" required>
                                <option value="">Select shipping method</option>
                                <option value="standard">Standard Shipping (Free)</option>
                                <option value="express">Express Shipping ($10.00)</option>
                                <option value="overnight">Overnight Shipping ($25.00)</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Billing Address -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="bi bi-house"></i> Billing Address
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="billing_first_name" class="form-label">First Name</label>
                                    <input type="text" class="form-control" id="billing_first_name" name="billing_first_name" value="{{ app.user.firstName }}" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="billing_last_name" class="form-label">Last Name</label>
                                    <input type="text" class="form-control" id="billing_last_name" name="billing_last_name" value="{{ app.user.lastName }}" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="billing_street" class="form-label">Street Address</label>
                            <input type="text" class="form-control" id="billing_street" name="billing_street" required>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="billing_city" class="form-label">City</label>
                                    <input type="text" class="form-control" id="billing_city" name="billing_city" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="billing_state" class="form-label">State</label>
                                    <input type="text" class="form-control" id="billing_state" name="billing_state" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="billing_postal_code" class="form-label">Postal Code</label>
                                    <input type="text" class="form-control" id="billing_postal_code" name="billing_postal_code" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="billing_country" class="form-label">Country</label>
                                    <input type="text" class="form-control" id="billing_country" name="billing_country" value="United States" required>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="billing_phone" class="form-label">Phone</label>
                            <input type="tel" class="form-control" id="billing_phone" name="billing_phone" value="{{ app.user.phone }}" required>
                        </div>
                    </div>
                </div>

                <!-- Shipping Address -->
                <div class="card mb-4">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="bi bi-truck"></i> Shipping Address
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="same_as_billing">
                            <label class="form-check-label" for="same_as_billing">
                                Same as billing address
                            </label>
                        </div>
                        
                        <div id="shipping_address_form">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="shipping_first_name" class="form-label">First Name</label>
                                        <input type="text" class="form-control" id="shipping_first_name" name="shipping_first_name" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="shipping_last_name" class="form-label">Last Name</label>
                                        <input type="text" class="form-control" id="shipping_last_name" name="shipping_last_name" required>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="shipping_street" class="form-label">Street Address</label>
                                <input type="text" class="form-control" id="shipping_street" name="shipping_street" required>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="shipping_city" class="form-label">City</label>
                                        <input type="text" class="form-control" id="shipping_city" name="shipping_city" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="shipping_state" class="form-label">State</label>
                                        <input type="text" class="form-control" id="shipping_state" name="shipping_state" required>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="shipping_postal_code" class="form-label">Postal Code</label>
                                        <input type="text" class="form-control" id="shipping_postal_code" name="shipping_postal_code" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="shipping_country" class="form-label">Country</label>
                                        <input type="text" class="form-control" id="shipping_country" name="shipping_country" value="United States" required>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="shipping_phone" class="form-label">Phone</label>
                                <input type="tel" class="form-control" id="shipping_phone" name="shipping_phone" required>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Place Order Button -->
                <div class="d-grid gap-2">
                    <button type="submit" class="btn btn-primary btn-lg">
                        <i class="bi bi-check-circle"></i> Place Order
                    </button>
                    <a href="{{ path('app_cart') }}" class="btn btn-outline-secondary">
                        <i class="bi bi-arrow-left"></i> Back to Cart
                    </a>
                </div>
            </div>
        </div>
    </form>
{% endblock %}

{% block javascripts %}
<script>
document.getElementById('same_as_billing').addEventListener('change', function() {
    const shippingForm = document.getElementById('shipping_address_form');
    const billingInputs = ['first_name', 'last_name', 'street', 'city', 'state', 'postal_code', 'country', 'phone'];
    
    if (this.checked) {
        billingInputs.forEach(field => {
            const billingValue = document.getElementById('billing_' + field).value;
            document.getElementById('shipping_' + field).value = billingValue;
        });
    }
});
</script>
{% endblock %} 